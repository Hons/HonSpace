<html>                                                                  
	<head>           
		<link rel="stylesheet" type="text/css" href="../css/style1.css" />
		<script src="http://code.jquery.com/jquery-1.4.2.min.js"></script>
		<script type="text/javascript">

	var centerX = 0;
	var centerY = 0;
	var width = 5;
	var id = 1;
	
	function newGridPlease() {
		id++;
		draw();
	}
	
	function load () {
	    makeTable();
		draw();
	}
	
	function moveY(val) {
		centerY+=val;
		draw();
	}
	
	function moveX(val) {
		centerX+=val;
		draw();
	}
	
	function loadCustom (newCenterX,newCenterY,newWidth) {
		centerX = newCenterX;
		centerY = newCenterY;
		width = newWidth;
		
	    makeTable();
		draw(centerX,centerY,width);
	}
	
	function makeTable(){
		var map = document.getElementById("map");
		
		while(map.hasChildNodes()){
			map.removeChild(map.firstChild);
		}
		
		var row;
		var cell;
		var div;
		for(i=0;i<=2*width;i++){
			row = document.createElement("tr");
			map.appendChild(row);
			for(j=0;j<=2*width;j++){
				cell = document.createElement("td");
				cell.setAttribute("onMouseOver","document.getElementById('"+i+":"+j+"').style.display='none'");
				cell.setAttribute("onMouseOut","document.getElementById('"+i+":"+j+"').style.display=''");
				div = document.createElement("div");
				div.id = i+":"+j;
				div.setAttribute("class","tile");
				row.appendChild(cell);
				cell.appendChild(div);				
			}
		}
	}
	
	function draw(){
		$.getJSON("../controller/grid/"+id+"/window.json",
	  		  {	centerX : 	centerX,
	  		    centerY : 	centerY,
	  		    width	:	width
	  		  },
			  function(data) {
			  //console.log(data);
					doodle(data);
			  });
	}
	
	function doodle(data) {
		//console.log(data.grid.places);
	
		for(i=0;i<=2*width;i++){
			for(j=0;j<=2*width;j++){
				//console.log(data.grid.places[i][j]);
			
				document.getElementById(i+":"+j).innerHTML='';
				document.getElementById(i+":"+j).appendChild(getElement(data.grid.places[i][j].type));
				
				for(k = 0; k < data.grid.places[i][j].objects.length; k++){
						var obj = document.createElement("IMG");
						obj.src = "../assets/objects/"+ data.grid.places[i][j].objects[k].type +".png";
						obj.setAttribute("class","z1");
						document.getElementById(i+":"+j).appendChild(obj);
				}
				//console.log(i+":"+j);
			}
		}
	}
	
	function getElement(type){
		if(type == 'Sun'){
			var Sun = document.createElement("IMG");
			Sun.src = "../assets/tile-sun.png";
			Sun.setAttribute("class","z0");
			return Sun;
		}
		if(type == 'Planet'){
			var Planet = document.createElement("IMG");
			Planet.src = "../assets/tile-planet.png";
			Planet.setAttribute("class","z0");
			return Planet;
		}
		if(type == 'EmptySpace'){
			var EmptySpace = document.createElement("IMG");
			EmptySpace.src = "../assets/tile-space.png";
			EmptySpace.setAttribute("class","z0");
			return EmptySpace;
		}
		
	}
	
	function explodeSomething(){
		$.getJSON("../controller/grid/"+id+"/explode.json",
	  		{	id : id
	  		},
			function(data) {
			});
		draw();
	}
	
	</script>
		                                                  
	</head>                                                                 
	<body onload="load()">
		<table>
			<tr>
				<td>
				</td>
				<td class="centered" onClick=moveY(-1)>
					<img class="arrow" src="../assets/arrows/up.png"/>
				</td>
				<td>
				</td>
			</tr>
			<tr>
				<td onClick=moveX(-1)>
					<img class="arrow" src="../assets/arrows/left.png"/>
				</td>
				<td>
					<table id="map">
					</table>
				</td>
				<td onClick=moveX(1)>
					<img class="arrow" src="../assets/arrows/right.png"/>
				</td>
			</tr>
			<tr>
				<td>
				</td>
				<td class="centered" onClick=moveY(1)>
					<img class="arrow" src="../assets/arrows/down.png"/>
				</td>
				<td>
				</td>
			</tr>
		</table>
		<button onClick="explodeSomething()">Explode Something!</button>
		<button onClick="newGridPlease()">New Grid Please</button>
		<button onClick="draw()">Refresh</button>
	</body>                                                                 
</html>